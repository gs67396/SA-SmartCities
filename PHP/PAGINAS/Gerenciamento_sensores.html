<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../CSS/loginstyle.css">
    <title>Cadrastamento de sensores de sensores</title>
</head>

<body>
    <h2>Monitoramento de sensores</h2>

    <hr>

    <h3>Cadastrar sensor</h3>
    <form id="cadastro_sensor" method="POST"> <!-- Formulário para cadastrar um novo sensor -->
        <label for="sensor_name">Nome do Sensor:</label> <!-- Campo para inserir o nome do sensor -->
        <input type="text" id="sensor_name" name="sensor_name" required><br><br>

        <label for="sensor_type">Tipo de Sensor:</label> <!-- Campo para inserir o tipo do sensor -->
        <input type="text" id="sensor_type" name="sensor_type" required><br><br> 

        <label for="location">Localização id do trem:</label> <!-- Campo para inserir a localização do sensor -->
        <input type="text" id="location" name="location" required><br><br>

        <button>Cadastrar Sensor</button>

    </form>

    <br><br>
    <hr>
    <br><br>

    <h2>Editar sensores</h2>

    <form id="editar_sensor" method="POST">
        <label for="sensor_id">ID do Sensor:</label> <!-- Campo para inserir o ID do sensor a ser editado -->
        <input type="text" id="sensor_id" name="sensor_id" required><br><br>

        <label for="new_sensor_name">Novo Nome do Sensor:</label> <!-- Campo para inserir o novo nome do sensor -->
        <input type="text" id="new_sensor_name" name="new_sensor_name"><br><br>

        <label for="new_sensor_type">Novo Tipo de Sensor:</label> <!-- Campo para inserir o novo tipo do sensor -->
        <input type="text" id="new_sensor_type" name="new_sensor_type"><br><br>

        <label for="new_location">Nova Localização id do trem:</label>
        <input type="text" id="new_location" name="new_location"><br><br>

        <button>Editar Sensor</button>

    </form>

        <br><br>
        <hr>
        <br><br>

        <h2>Lista de Sensores</h2>

        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>ID do Sensor</th>
                        <th>Nome do Sensor:</th>
                        <th>Tipo de Sensor:</th>
                        <th>Localização id do trem:</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>001</td>
                        <td>Sensor de Temperatura</td>
                        <td>Temperatura</td>
                        <td>Trem A - Vagão 1</td>
                        <td><button onclick="excluirItem(this, '001')">Excluir</button>
</td>
                </tbody>
            </table>
        </div>

</body>

</html>

<script>

// Cadastrar 
const formCadastro = document.getElementById('cadastro_sensor');
// Formulário de edição
const formEditar = document.getElementById('editar_sensor');
// Tabela criar
const tabela = document.querySelector('.table tbody');

// Ao cadastrar sensor
formCadastro.addEventListener('submit', e => {
  e.preventDefault();

  const nome = document.getElementById('sensor_name').value;
  const tipo = document.getElementById('sensor_type').value;
  const local = document.getElementById('location').value;

  fetch('process.php', {
    method: 'POST',
    body: new URLSearchParams({ action: 'create', nome, tipo, valor: local })
  })
  .then(() => {
    formCadastro.reset();
    carregarSensores();
  });
});

// Ao editar sensor
formEditar.addEventListener('submit', e => {
  e.preventDefault();

  const id = document.getElementById('sensor_id').value;
  const nome = document.getElementById('new_sensor_name').value;
  const tipo = document.getElementById('new_sensor_type').value;
  const local = document.getElementById('new_location').value;

  fetch('process.php', {
    method: 'POST',
    body: new URLSearchParams({ action: 'update', id, nome, tipo, valor: local })
  })
  .then(() => {
    formEditar.reset();
    carregarSensores();
  });
});

// Listar sensores
function carregarSensores() {
  fetch('process.php', {
    method: 'POST',
    body: new URLSearchParams({ action: 'list' })
  })
  .then(r => r.json())
  .then(data => {
    tabela.innerHTML = '';
    data.forEach(s => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${s.id}</td>
        <td>${s.nome}</td>
        <td>${s.tipo}</td>
        <td>${s.valor}</td>
        <td><button onclick="excluir(${s.id})">Excluir</button></td>
      `;
      tabela.appendChild(tr);
    });
  });
}

// Excluir sensor
function excluir(id) {
  if (confirm('Excluir este sensor?')) {
    fetch('process.php', {
      method: 'POST',
      body: new URLSearchParams({ action: 'delete', id })
    })
    .then(() => carregarSensores());
  }
}

// Carrega os sensores assim que a página abrir
carregarSensores();

<script>
