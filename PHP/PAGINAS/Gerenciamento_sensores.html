<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../CSS/loginstyle.css">
    <title>Cadrastamento de sensores de sensores</title>
</head>

<body>
    <h2>Monitoramento de sensores</h2>

    <hr>

    <h3>Cadastrar sensor</h3>
    <form id="cadastro_sensor" method="POST"> <!-- Formulário para cadastrar um novo sensor -->
        <label for="sensor_name">Nome do Sensor:</label> <!-- Campo para inserir o nome do sensor -->
        <input type="text" id="sensor_name" name="sensor_name" required><br><br>

        <label for="sensor_type">Tipo de Sensor:</label> <!-- Campo para inserir o tipo do sensor -->
        <input type="text" id="sensor_type" name="sensor_type" required><br><br> 

        <label for="location">Localização id do trem:</label> <!-- Campo para inserir a localização do sensor -->
        <input type="text" id="location" name="location" required><br><br>

        <button>Cadastrar Sensor</button>

    </form>

    <br><br>
    <hr>
    <br><br>

    <h2>Editar sensores</h2>

    <form id="editar_sensor" method="POST">
        <label for="sensor_id">ID do Sensor:</label> <!-- Campo para inserir o ID do sensor a ser editado -->
        <input type="text" id="sensor_id" name="sensor_id" required><br><br>

        <label for="new_sensor_name">Novo Nome do Sensor:</label> <!-- Campo para inserir o novo nome do sensor -->
        <input type="text" id="new_sensor_name" name="new_sensor_name"><br><br>

        <label for="new_sensor_type">Novo Tipo de Sensor:</label> <!-- Campo para inserir o novo tipo do sensor -->
        <input type="text" id="new_sensor_type" name="new_sensor_type"><br><br>

        <label for="new_location">Nova Localização id do trem:</label>
        <input type="text" id="new_location" name="new_location"><br><br>

        <button>Editar Sensor</button>

    </form>

        <br><br>
        <hr>
        <br><br>

        <h2>Lista de Sensores</h2>

        <div class="table">
            <table>
                <thead>
                    <tr>
                        <th>ID do Sensor</th>
                        <th>Nome do Sensor:</th>
                        <th>Tipo de Sensor:</th>
                        <th>Localização id do trem:</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>001</td>
                        <td>Sensor de Temperatura</td>
                        <td>Temperatura</td>
                        <td>Trem A - Vagão 1</td>
                        <td><button onclick="excluirItem(this, '001')">Excluir</button>
</td>
                </tbody>
            </table>
        </div>

</body>

</html>

<script>
const form = document.getElementById('sensorForm');
const tabela = document.querySelector('#tabelaSensores tbody');

form.addEventListener('submit', e => {
  e.preventDefault();
  const id = document.getElementById('sensorId').value;
  const nome = document.getElementById('nome').value;
  const tipo = document.getElementById('tipo').value;
  const valor = document.getElementById('valor').value;

  const action = id ? 'update' : 'create';

  fetch('process.php', {
    method: 'POST',
    body: new URLSearchParams({ id, nome, tipo, valor, action })
  }).then(() => {
    form.reset();
    carregarSensores();
  });
});

function carregarSensores() {
  fetch('process.php', {
    method: 'POST',
    body: new URLSearchParams({ action: 'list' })
  })
  .then(r => r.json())
  .then(data => {
    tabela.innerHTML = '';
    data.forEach(s => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${s.id}</td>
        <td>${s.nome}</td>
        <td>${s.tipo}</td>
        <td>${s.valor}</td>
        <td>
          <button onclick="editar(${s.id}, '${s.nome}', '${s.tipo}', '${s.valor}')">Editar</button>
          <button onclick="excluir(${s.id})">Excluir</button>
        </td>`;
      tabela.appendChild(tr);
    });
  });
}

function editar(id, nome, tipo, valor) {
  document.getElementById('sensorId').value = id;
  document.getElementById('nome').value = nome;
  document.getElementById('tipo').value = tipo;
  document.getElementById('valor').value = valor;
}

function excluir(id) {
  if (confirm('Deseja realmente excluir este sensor?')) {
    fetch('process.php', {
      method: 'POST',
      body: new URLSearchParams({ id, action: 'delete' })
    }).then(() => carregarSensores());
  }
}

// Carrega ao abrir
carregarSensores();
</script>
